
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ú® VAMOS DE SELFIE?</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      background: #fff9f0;
      color: #333;
      padding: 16px;
      text-align: center;
    }
    h1 {
      margin: 12px 0 16px;
      font-size: 22px;
      color: #d63031;
    }
    #videoContainer {
      position: relative;
      display: inline-block;
      margin: 0 auto;
      max-width: 100%;
      border: 2px solid #ccc;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
    }
    #video {
      width: 100%;
      display: block;
      transform: scaleX(-1); /* Espelho */
    }
    #mask {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%,-50%);
      max-width: 75%;
      max-height: 85%;
      pointer-events: none;
      user-select: none;
      z-index: 10;
    }
    .controls {
      margin: 16px 0;
    }
    .mask-select {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin: 12px 0;
    }
    .mask-btn {
      width: 85px;
      height: 85px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mask-btn.active {
      border-color: #ff6b6b;
      background: #fff0f0;
    }
    .mask-btn img {
      max-width: 90%;
      max-height: 100%;
    }
    .btn {
      background: #4ecdc4;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 16px;
      cursor: pointer;
      margin: 8px;
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #error {
      color: #e17055;
      margin-top: 16px;
      font-weight: bold;
    }
    #previewContainer {
      display: none;
      margin-top: 20px;
      max-width: 300px;
    }
    #previewCanvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
    }
    #previewActions {
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <h1> Vamos de Selfie?</h1>
    <button style="background:#7f8c8d;color:white;border:none;border-radius:50px;padding:8px 20px;font-size:0.95rem;cursor:pointer;margin:12px 0 16px;" onclick="location.href='index.html'">Voltar</button>

  <div id="videoContainer">
    <video id="video" autoplay playsinline muted></video>
    <img id="mask" src="" draggable="false" style="display: none;" />
  </div>

  <div class="controls">
    <div class="mask-select" id="maskButtons"></div>
    <button class="btn" id="captureBtn" disabled>üì∏ Tirar Foto</button>
  </div>

  <div id="previewContainer">
    <canvas id="previewCanvas"></canvas>
    <div id="previewActions">
      <button class="btn" id="savePreviewBtn">üíæ Salvar</button>
      <button class="btn" id="cancelPreviewBtn">‚Ü©Ô∏è Voltar</button>
    </div>
  </div>

  <div id="error"></div>

  <!-- html2canvas (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const maskFiles = [
      '11.png', '12.png', '13.png', '14.png', '5.png',
      '6.png', '7.png', '8.png', '9.png', '10.png'
    ];

    const video = document.getElementById('video');
    const maskImg = document.getElementById('mask');
    const captureBtn = document.getElementById('captureBtn');
    const errorDiv = document.getElementById('error');
    const maskButtons = document.getElementById('maskButtons');
    const previewContainer = document.getElementById('previewContainer');
    const previewCanvas = document.getElementById('previewCanvas');
    const savePreviewBtn = document.getElementById('savePreviewBtn');
    const cancelPreviewBtn = document.getElementById('cancelPreviewBtn');

    let currentMask = null;
    let capturedImageData = null;

    // Criar bot√µes das m√°scaras
    maskFiles.forEach((file, index) => {
      const img = new Image();
      img.src = file;
      img.onload = () => {
        const btn = document.createElement('div');
        btn.className = 'mask-btn';
        btn.innerHTML = `<img src="${file}" alt="M√°scara ${index + 1}" />`;
        btn.onclick = () => selectMask(file);
        maskButtons.appendChild(btn);
      };
      img.onerror = () => {};
    });

    function selectMask(file) {
      currentMask = file;
      maskImg.src = file;
      maskImg.style.display = 'block';

      document.querySelectorAll('.mask-btn').forEach(b => b.classList.remove('active'));
      event.target.closest('.mask-btn').classList.add('active');
      captureBtn.disabled = false;
    }

    // Acessar c√¢mera
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch (err) {
        errorDiv.textContent = '‚ö†Ô∏è Permiss√£o de c√¢mera necess√°ria.';
      }
    }
    startCamera();

    // === Tirar foto (como print da tela) ===
    captureBtn.addEventListener('click', () => {
      // Capturar o container inteiro (v√≠deo + m√°scara)
      html2canvas(document.getElementById('videoContainer'), {
        scale: 2, // Qualidade alta
        backgroundColor: null // Fundo transparente
      }).then(canvas => {
        capturedImageData = canvas.toDataURL('image/png');
        showPreview(canvas);
      });
    });

    function showPreview(fullCanvas) {
      const maxWidth = 300;
      const scaleFactor = maxWidth / fullCanvas.width;
      const previewWidth = maxWidth;
      const previewHeight = fullCanvas.height * scaleFactor;

      previewCanvas.width = previewWidth;
      previewCanvas.height = previewHeight;

      const previewCtx = previewCanvas.getContext('2d');
      previewCtx.drawImage(fullCanvas, 0, 0, previewWidth, previewHeight);

      previewContainer.style.display = 'block';
      captureBtn.style.display = 'none';
    }

    savePreviewBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'minha-mascara.png';
      link.href = capturedImageData;
      link.click();
      goBackToCamera();
    });

    cancelPreviewBtn.addEventListener('click', goBackToCamera);

    function goBackToCamera() {
      previewContainer.style.display = 'none';
      captureBtn.style.display = 'inline-block';
      capturedImageData = null;
    }
  </script>
</body>
</html>
